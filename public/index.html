<!DOCTYPE html>
<html lang="en" style="height:100%">

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="icon" type="image/png" href="icon.png" />
  <title>Search Website</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
    }

    /* 1. LAYOUT: Vertical Flex for the whole page */
    body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      background: linear-gradient(135deg, #f5efe7 0%, #e8dfd2 100%);
      display: flex;
      flex-direction: column;
      min-height: 0;
      font-family: 'Inter', sans-serif;
    }

    a.nav-link {
      color: #007b00;
      text-decoration: none;
      transition: color 0.2s ease;
    }

    a.nav-link:hover {
      color: #005500;
    }

    /* 2. NAVBAR */
    nav.navbar {
      position: relative !important;
      flex: 0 0 auto;
      z-index: 1030;
      background: rgba(255, 255, 255, 0.9) !important;
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
    }

    /* 3. CONTAINER */
    #container {
      display: flex;
      flex: 1;
      height: 100%;
      margin-top: 0;
      overflow: hidden;
      min-height: 0;
    }

    /* 4. SEARCH FRAME */
    #searchFrame {
      min-width: 200px;
      overflow: hidden;
      min-height: 250px;
      flex-shrink: 0;
      z-index: 1;
      background: rgba(255, 255, 255, 0.4);
      backdrop-filter: blur(5px);
      transition: all 0.3s ease;
    }

    #searchFrame h1 {
      font-family: 'Inter', sans-serif;
      font-weight: 800;
      background: linear-gradient(45deg, #198754, #20c997);
      background-clip: text;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 1.5rem !important;
    }

    #searchInput {
      border-radius: 50px;
      padding: 12px 20px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    #searchInput:focus {
      box-shadow: 0 8px 25px rgba(25, 135, 84, 0.15);
      border-color: #198754;
      transform: translateY(-2px);
    }

    #searchButton {
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      padding: 10px 25px;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    #searchButton:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(25, 135, 84, 0.3) !important;
    }

    #searchButton:active {
      transform: translateY(0);
    }

    /* 5. DIVIDER (Desktop Default) */
    #divider {
      flex: 0 0 6px;
      cursor: col-resize;
      background: #ddd;
      position: relative;
      z-index: 100;
      transition: background 0.2s;
    }

    #divider:hover {
      background: #ccc;
    }

    #divider::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 4px;
      height: 30px;
      background: #aaa;
      border-radius: 2px;
      transform: translate(-50%, -50%);
    }

    /* 6. RESULT FRAME */
    #resultFrame {
      overflow-y: auto;
      flex: 1;
      min-height: 150px;
      z-index: 0;
      padding: 2rem !important;
      transition: opacity 0.3s ease;
      opacity: 1;

      /* Scroll Performance Optimizations */
      -webkit-overflow-scrolling: touch;
      will-change: scroll-position;
      transform: translateZ(0);
      backface-visibility: hidden;
      overscroll-behavior: contain;
    }

    /* Custom Scrollbar for Result Frame */
    #resultFrame::-webkit-scrollbar {
      width: 8px;
    }

    #resultFrame::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
    }

    #resultFrame::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #198754 0%, #20c997 100%);
      border-radius: 10px;
      border: 2px solid transparent;
      background-clip: padding-box;
    }

    #resultFrame::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #146c43 0%, #1aa179 100%);
      background-clip: padding-box;
    }

    /* Firefox Scrollbar */
    #resultFrame {
      scrollbar-width: thin;
      scrollbar-color: #198754 rgba(0, 0, 0, 0.05);
    }

    /* Dark Mode Scrollbar */
    body.dark-mode #resultFrame::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
    }

    body.dark-mode #resultFrame::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #8fe08b 0%, #20c997 100%);
      background-clip: padding-box;
    }

    body.dark-mode #resultFrame::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #b0f2ac 0%, #2dd4a8 100%);
      background-clip: padding-box;
    }

    body.dark-mode #resultFrame {
      scrollbar-color: #8fe08b rgba(255, 255, 255, 0.05);
    }

    /* === SEARCH SUMMARY === */
    #searchSummary {
      display: none;
      background: linear-gradient(135deg, rgba(25, 135, 84, 0.06) 0%, rgba(32, 201, 151, 0.06) 100%);
      border-radius: 20px;
      padding: 1.5rem 1.75rem;
      margin-bottom: 1.5rem;
      border: 1px solid rgba(25, 135, 84, 0.12);
      backdrop-filter: blur(12px);
      animation: fadeInUp 0.5s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
    }

    #searchSummary.visible {
      display: block;
    }

    #searchSummary .summary-header {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    #searchSummary .summary-icon {
      width: 28px;
      height: 28px;
      fill: #198754;
      flex-shrink: 0;
    }

    #searchSummary .summary-query {
      font-size: 1.25rem;
      font-weight: 700;
      color: #198754;
      margin: 0;
    }

    #searchSummary .summary-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1.25rem;
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid rgba(25, 135, 84, 0.1);
    }

    #searchSummary .summary-meta span {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      background: rgba(25, 135, 84, 0.08);
      padding: 0.35rem 0.75rem;
      border-radius: 20px;
      font-weight: 500;
    }

    /* Main Overview Section */
    #searchSummary .summary-overview {
      margin-bottom: 1rem;
    }

    #searchSummary .summary-overview-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: #198754;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    #searchSummary .summary-description {
      font-size: 0.95rem;
      line-height: 1.7;
      color: #444;
      margin: 0;
    }

    /* AI Badge */
    #searchSummary .ai-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      font-size: 0.65rem;
      font-weight: 600;
      padding: 0.2rem 0.5rem;
      border-radius: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-left: 0.5rem;
      vertical-align: middle;
    }

    #searchSummary .ai-badge svg {
      width: 10px;
      height: 10px;
      fill: currentColor;
    }

    /* Loading Shimmer */
    #searchSummary .summary-loading {
      background: linear-gradient(90deg,
          rgba(25, 135, 84, 0.08) 25%,
          rgba(25, 135, 84, 0.15) 50%,
          rgba(25, 135, 84, 0.08) 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 8px;
      height: 1rem;
      margin-bottom: 0.5rem;
    }

    #searchSummary .summary-loading.line-1 {
      width: 100%;
    }

    #searchSummary .summary-loading.line-2 {
      width: 85%;
    }

    #searchSummary .summary-loading.line-3 {
      width: 70%;
    }

    @keyframes shimmer {
      0% {
        background-position: 200% 0;
      }

      100% {
        background-position: -200% 0;
      }
    }

    body.dark-mode #searchSummary .summary-loading {
      background: linear-gradient(90deg,
          rgba(143, 224, 139, 0.08) 25%,
          rgba(143, 224, 139, 0.15) 50%,
          rgba(143, 224, 139, 0.08) 75%);
      background-size: 200% 100%;
    }

    /* Insights Grid */
    #searchSummary .summary-insights {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 1rem;
      border-top: 1px solid rgba(25, 135, 84, 0.1);
    }

    #searchSummary .insight-card {
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      padding: 1rem;
      border: 1px solid rgba(25, 135, 84, 0.08);
    }

    #searchSummary .insight-title {
      font-size: 0.75rem;
      font-weight: 600;
      color: #198754;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 0.6rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    #searchSummary .insight-content {
      font-size: 0.85rem;
      color: #555;
      line-height: 1.5;
    }

    /* Source Tags */
    #searchSummary .source-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    #searchSummary .source-tag {
      background: linear-gradient(135deg, rgba(25, 135, 84, 0.12) 0%, rgba(32, 201, 151, 0.12) 100%);
      color: #146c43;
      padding: 0.3rem 0.6rem;
      border-radius: 8px;
      font-size: 0.75rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.3rem;
      text-decoration: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    #searchSummary .source-tag:hover {
      background: linear-gradient(135deg, rgba(25, 135, 84, 0.25) 0%, rgba(32, 201, 151, 0.25) 100%);
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(25, 135, 84, 0.15);
    }

    #searchSummary .source-tag .count {
      background: rgba(25, 135, 84, 0.2);
      padding: 0.1rem 0.35rem;
      border-radius: 4px;
      font-size: 0.7rem;
    }

    /* Topic Pills */
    #searchSummary .topic-pills {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
    }

    #searchSummary .topic-pill {
      background: rgba(25, 135, 84, 0.1);
      color: #198754;
      padding: 0.25rem 0.6rem;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    /* Content Type Icons */
    #searchSummary .content-types {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    #searchSummary .content-type {
      display: flex;
      align-items: center;
      gap: 0.35rem;
      color: #555;
      font-size: 0.85rem;
    }

    #searchSummary .content-type-icon {
      width: 18px;
      height: 18px;
      fill: #198754;
    }

    /* Knowledge Graph */
    #searchSummary .knowledge-graph {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
      padding: 1rem;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 12px;
      border: 1px solid rgba(25, 135, 84, 0.08);
    }

    #searchSummary .kg-image {
      width: 90px;
      height: 90px;
      border-radius: 12px;
      object-fit: cover;
      flex-shrink: 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    #searchSummary .kg-info {
      flex: 1;
      min-width: 0;
    }

    #searchSummary .kg-title {
      font-weight: 700;
      font-size: 1.05rem;
      color: #198754;
      margin-bottom: 0.25rem;
    }

    #searchSummary .kg-type {
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 0.5rem;
      text-transform: capitalize;
    }

    #searchSummary .kg-description {
      font-size: 0.9rem;
      color: #555;
      line-height: 1.5;
    }

    /* Dark mode for summary */
    body.dark-mode #searchSummary {
      background: linear-gradient(135deg, rgba(143, 224, 139, 0.06) 0%, rgba(32, 201, 151, 0.04) 100%);
      border-color: rgba(143, 224, 139, 0.15);
    }

    body.dark-mode #searchSummary .summary-query {
      color: #8fe08b;
    }

    body.dark-mode #searchSummary .summary-icon {
      fill: #8fe08b;
    }

    body.dark-mode #searchSummary .summary-meta {
      color: #aaa;
      border-color: rgba(143, 224, 139, 0.1);
    }

    body.dark-mode #searchSummary .summary-meta span {
      background: rgba(143, 224, 139, 0.1);
    }

    body.dark-mode #searchSummary .summary-overview-title {
      color: #8fe08b;
    }

    body.dark-mode #searchSummary .summary-description {
      color: #ccc;
    }

    body.dark-mode #searchSummary .summary-insights {
      border-color: rgba(143, 224, 139, 0.1);
    }

    body.dark-mode #searchSummary .insight-card {
      background: rgba(30, 30, 30, 0.5);
      border-color: rgba(143, 224, 139, 0.1);
    }

    body.dark-mode #searchSummary .insight-title {
      color: #8fe08b;
    }

    body.dark-mode #searchSummary .insight-content {
      color: #bbb;
    }

    body.dark-mode #searchSummary .source-tag {
      background: linear-gradient(135deg, rgba(143, 224, 139, 0.15) 0%, rgba(32, 201, 151, 0.1) 100%);
      color: #8fe08b;
    }

    body.dark-mode #searchSummary .source-tag:hover {
      background: linear-gradient(135deg, rgba(143, 224, 139, 0.3) 0%, rgba(32, 201, 151, 0.2) 100%);
      box-shadow: 0 4px 8px rgba(143, 224, 139, 0.15);
    }

    body.dark-mode #searchSummary .source-tag .count {
      background: rgba(143, 224, 139, 0.2);
    }

    body.dark-mode #searchSummary .topic-pill {
      background: rgba(143, 224, 139, 0.12);
      color: #8fe08b;
    }

    body.dark-mode #searchSummary .content-type {
      color: #bbb;
    }

    body.dark-mode #searchSummary .content-type-icon {
      fill: #8fe08b;
    }

    body.dark-mode #searchSummary .knowledge-graph {
      background: rgba(30, 30, 30, 0.5);
      border-color: rgba(143, 224, 139, 0.1);
    }

    body.dark-mode #searchSummary .kg-title {
      color: #8fe08b;
    }

    body.dark-mode #searchSummary .kg-type {
      color: #999;
    }

    body.dark-mode #searchSummary .kg-description {
      color: #bbb;
    }

    /* Result Cards */
    .result-card {
      border: none;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.7);
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02), 0 1px 3px rgba(0, 0, 0, 0.05);
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      overflow: hidden;
    }

    .result-card:hover {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 20px 30px rgba(0, 0, 0, 0.08), 0 10px 10px rgba(0, 0, 0, 0.04);
      background: rgba(255, 255, 255, 0.95);
      z-index: 10;
    }

    .result-card h5 a {
      color: #198754;
      font-weight: 700;
      transition: color 0.2s;
    }

    .result-card h5 a:hover {
      color: #146c43;
      text-decoration: underline !important;
    }

    .result-card img {
      transition: transform 0.5s ease;
    }

    .result-card:hover img {
      transform: scale(1.1);
    }

    /* === ANIMATIONS === */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-up {
      animation: fadeInUp 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
      opacity: 0;
    }

    /* === DARK MODE STYLES === */
    body.dark-mode {
      background: #000000;
      color: #e0e0e0;
    }

    body.dark-mode a.nav-link {
      color: #8fe08b !important;
    }

    body.dark-mode a.nav-link:hover {
      color: #b0f2ac !important;
    }

    body.dark-mode #divider {
      background: #444;
    }

    body.dark-mode #divider:hover {
      background: #555;
    }

    body.dark-mode .result-card {
      background: rgba(20, 20, 20, 0.8) !important;
      color: #eee !important;
      box-shadow: 0 4px 6px rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    body.dark-mode .result-card:hover {
      background: rgba(30, 30, 30, 0.95) !important;
      box-shadow: 0 20px 30px rgba(255, 255, 255, 0.05);
      border-color: rgba(255, 255, 255, 0.2);
    }

    body.dark-mode .result-card .text-muted {
      color: #aaa !important;
    }

    body.dark-mode nav.navbar {
      background: rgba(30, 30, 30, 0.8) !important;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05) !important;
    }

    body.dark-mode nav.navbar .nav-link {
      color: #8fe08b !important;
    }

    body.dark-mode #themeLabel {
      color: #8fe08b !important;
    }

    body.dark-mode #searchFrame {
      background: rgba(0, 0, 0, 0.2);
    }

    body.dark-mode #searchInput {
      background: #333;
      border-color: #444;
      color: #fff;
    }

    body.dark-mode #searchInput:focus {
      background: #3a3a3a;
      border-color: #8fe08b;
      box-shadow: 0 8px 25px rgba(143, 224, 139, 0.1);
    }

    /* Improved Placeholder Visibility */
    body.dark-mode #searchInput::placeholder {
      color: #aaa;
      opacity: 1;
    }

    /* === THEME TOGGLE === */
    #themeToggleBtn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 0;
      color: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.3s ease;
    }

    #themeToggleBtn:hover {
      transform: scale(1.1);
    }

    .icon-sun,
    .icon-moon {
      width: 24px;
      height: 24px;
      fill: currentColor;
      display: none;
    }

    body:not(.dark-mode) .icon-moon {
      display: block;
      fill: #555;
    }

    body.dark-mode .icon-sun {
      display: block;
      fill: #f1c40f;
    }

    /* === FLOATING SEARCH BUTTON === */
    #floatingSearchBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #198754;
      color: white;
      border: none;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);

      display: none;
      /* Hidden on desktop */
      align-items: center;
      justify-content: center;
      z-index: 2000;
      cursor: pointer;

      /* Animation: Start invisible */
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
      transform: scale(0);
      opacity: 0;
    }

    #floatingSearchBtn:active {
      transform: scale(0.9) !important;
    }

    #floatingSearchBtn svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    /* Class added by JS to show the button */
    #floatingSearchBtn.visible {
      transform: scale(1);
      opacity: 1;
    }

    /* === MOBILE FIXES === */
    @media(max-width:768px) {

      /* Restore page scrolling */
      html,
      body {
        height: auto !important;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch;
      }

      /* Enable button layout (visibility controlled by JS class) */
      #floatingSearchBtn {
        display: flex !important;
      }

      #container {
        flex-direction: column;
        height: auto !important;
        display: flex !important;
        overflow: visible !important;
      }

      #divider {
        display: none !important;
      }

      #searchFrame {
        /* FIX FOR GAP: Don't grow, just fit content */
        flex: 0 0 auto !important;
        width: 100% !important;
        min-height: auto !important;
        padding-bottom: 1.5rem !important;
        border-right: none !important;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.6);
        /* Slightly more opaque on mobile */
      }

      #resultFrame {
        /* Take remaining space */
        flex: 1 0 auto !important;
        height: auto !important;
        overflow: visible !important;
        padding: 1rem !important;
      }

      /* Mobile Search Summary */
      #searchSummary {
        padding: 1rem !important;
        margin-bottom: 1rem !important;
        border-radius: 12px !important;
      }

      #searchSummary .summary-header {
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      #searchSummary .summary-query {
        font-size: 1rem !important;
        word-break: break-word;
      }

      #searchSummary .summary-meta {
        gap: 0.5rem !important;
        flex-wrap: wrap;
      }

      #searchSummary .summary-meta span {
        font-size: 0.75rem !important;
        padding: 0.25rem 0.5rem !important;
      }

      #searchSummary .summary-overview-title {
        font-size: 0.7rem !important;
      }

      #searchSummary .summary-description {
        font-size: 0.85rem !important;
        line-height: 1.6 !important;
      }

      /* Single column insights on mobile */
      #searchSummary .summary-insights {
        grid-template-columns: 1fr !important;
        gap: 0.75rem !important;
      }

      #searchSummary .insight-card {
        padding: 0.75rem !important;
      }

      #searchSummary .insight-title {
        font-size: 0.7rem !important;
      }

      /* Larger touch targets for source tags */
      #searchSummary .source-tag {
        padding: 0.4rem 0.7rem !important;
        font-size: 0.8rem !important;
        min-height: 32px;
      }

      #searchSummary .topic-pill {
        padding: 0.35rem 0.7rem !important;
        font-size: 0.75rem !important;
      }

      /* Result cards touch-friendly */
      .result-card {
        border-radius: 12px !important;
      }

      /* Disable hover effects on touch devices */
      @media (hover: none) {
        .result-card:hover {
          transform: none !important;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.02), 0 1px 3px rgba(0, 0, 0, 0.05) !important;
        }

        #searchSummary .source-tag:hover {
          transform: none !important;
        }
      }

      /* Knowledge Graph mobile */
      #searchSummary .knowledge-graph {
        flex-direction: column;
        text-align: center;
      }

      #searchSummary .kg-image {
        margin: 0 auto;
      }
    }

    /* Extra small devices */
    @media(max-width:480px) {
      #searchFrame h1 {
        font-size: 1.5rem !important;
      }

      #searchInput {
        font-size: 16px !important;
        /* Prevents zoom on iOS */
      }

      #searchButton {
        padding: 8px 16px !important;
        font-size: 0.9rem !important;
      }

      .result-card .card-body {
        padding: 0.75rem !important;
      }

      .result-card h5 {
        font-size: 0.95rem !important;
      }

      .result-card .card-text {
        font-size: 0.8rem !important;
      }
    }
  </style>
</head>

<body id="pageBody" class="h-100">

  <nav class="navbar shadow-sm px-3 d-flex justify-content-between">
    <div class="d-flex align-items-center gap-5 gap-md-3 gap-lg-5">
      <a class="nav-link fw-bold" href="#">Home</a>
      <a class="nav-link fw-bold" href="https://aryak-mohanty.github.io/Projects/">List</a>
    </div>
    <div class="d-flex align-items-center gap-2">
      <span id="themeLabel" class="nav-link fw-bold" style="min-width: 40px; text-align: right;">Light</span>
      <button id="themeToggleBtn" class="nav-link" aria-label="Toggle Theme">
        <svg class="icon-sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zm0 9c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z" />
        </svg>
        <svg class="icon-moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
          <path
            d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-3.03 0-5.5-2.47-5.5-5.5 0-1.82.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z" />
        </svg>
      </button>
    </div>
  </nav>

  <div id="container" class="d-flex">
    <div id="searchFrame" class="p-4 d-flex flex-column align-items-center justify-content-center border-end">
      <h1 class="mb-4">Search</h1>
      <input id="searchInput" class="form-control mb-3" style="max-width:300px" autocomplete="off"
        placeholder="Type to search...">
      <button id="searchButton" class="btn btn-success btn-lg d-flex align-items-center gap-2 rounded-pill shadow-sm">
        <img src="icons8-search-48.png" style="height:22px;width:22px; filter: brightness(0) invert(1);"> Search
      </button>
    </div>

    <div id="divider"></div>
    <div id="resultFrame" class="p-3">
      <!-- Search Summary Section -->
      <div id="searchSummary">
        <div class="summary-header">
          <svg class="summary-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path
              d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z" />
          </svg>
          <h4 class="summary-query"></h4>
        </div>
        <div class="summary-meta"></div>

        <!-- Knowledge Graph (if available) -->
        <div id="knowledgeGraph" class="knowledge-graph" style="display: none;"></div>

        <!-- Overview Section -->
        <div class="summary-overview">
          <div class="summary-overview-title">
            <svg style="width:16px;height:16px;fill:currentColor" viewBox="0 0 24 24">
              <path
                d="M12 2l.117.007a1 1 0 0 1 .876.876L13 3v1.14l2.708.717a2 2 0 0 1 1.286 2.523L16.969 8h2.031a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h2.031l-.025-.62a2 2 0 0 1 1.286-2.523L11 4.14V3a1 1 0 0 1 1-1zm0 10a3 3 0 1 0 0 6 3 3 0 0 0 0-6z" />
            </svg>
            Quick Overview
            <span class="ai-badge"><svg viewBox="0 0 24 24">
                <path
                  d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
              </svg> AI</span>
          </div>
          <div id="summaryContent">
            <p class="summary-description"></p>
          </div>
        </div>

        <!-- Insights Grid -->
        <div id="summaryInsights" class="summary-insights"></div>
      </div>
      <!-- Results Grid -->
      <div id="resultsGrid" class="row g-4"></div>
    </div>
  </div>

  <button id="floatingSearchBtn" aria-label="Back to Search">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
      <path
        d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z" />
    </svg>
  </button>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    /* === Floating Search Button === */
    document.getElementById('floatingSearchBtn').onclick = () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      document.getElementById('searchInput').focus();
    };

    /* === Dark Mode (System Preference Enabled) === */
    const themeBtn = document.getElementById('themeToggleBtn');
    const themeLabel = document.getElementById('themeLabel');
    const colorSchemeQuery = window.matchMedia('(prefers-color-scheme: dark)');

    function applyTheme() {
      const dark = document.body.classList.contains('dark-mode');
      themeLabel.textContent = dark ? 'Dark' : 'Light';
    }

    function checkSystemTheme() {
      const systemPrefersDark = colorSchemeQuery.matches;
      const storedTheme = localStorage.getItem('theme');

      if (storedTheme === 'dark' || (storedTheme === null && systemPrefersDark)) {
        document.body.classList.add('dark-mode');
      } else {
        document.body.classList.remove('dark-mode');
      }
      applyTheme();
    }

    checkSystemTheme();

    colorSchemeQuery.addEventListener('change', checkSystemTheme);

    themeBtn.onclick = () => {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
      applyTheme();
    };

    /* === Global Vars for Search === */
    let page = 1;
    let query = '';

    /* === Search Logic === */
    function search() {
      const q = document.getElementById('searchInput').value.trim();
      if (!q) return;

      query = q;
      page = 1;

      const box = document.getElementById('resultFrame');

      // 1. Fade out old results
      box.style.opacity = '0';

      // 2. Wait for fade out
      setTimeout(() => {
        // Use local server endpoint
        fetch(`/search?q=${encodeURIComponent(q)}`)
          .then(r => r.json())
          .then(d => {
            // 3. Reset scroll and prepare container
            box.scrollTop = 0;

            // Disable transition to instantly show container (so items can animate in)
            box.style.transition = 'none';
            box.style.opacity = '1';

            // Display search summary
            displaySearchSummary(q, d);

            displayResults(d.items || []);

            // Re-enable transition for next time (after a small tick)
            requestAnimationFrame(() => {
              box.style.transition = 'opacity 0.3s ease';
            });
          })
          .catch(err => {
            console.error(err);
            hideSearchSummary();
            displayResults([]);
            box.style.opacity = '1';
          });
      }, 300); // Match CSS transition duration
    }

    document.getElementById('searchButton').onclick = search;
    document.getElementById('searchInput').onkeydown = e => { if (e.key === 'Enter') search(); };

    /* === Display Search Summary === */
    function displaySearchSummary(searchQuery, data) {
      const summary = document.getElementById('searchSummary');
      const queryEl = summary.querySelector('.summary-query');
      const metaEl = summary.querySelector('.summary-meta');
      const descEl = summary.querySelector('.summary-description');
      const insightsEl = document.getElementById('summaryInsights');
      const kgEl = document.getElementById('knowledgeGraph');

      // Set query
      queryEl.textContent = `"${searchQuery}"`;

      // Set meta info with enhanced stats
      const totalResults = data.searchInformation?.formattedTotalResults || '0';
      const searchTime = data.searchInformation?.formattedSearchTime || '0';
      const itemsShown = data.items?.length || 0;

      metaEl.innerHTML = `
        <span>üìä ${totalResults} results</span>
        <span>‚è±Ô∏è ${searchTime}s</span>
        <span>üìÑ Showing ${itemsShown} results</span>
      `;

      // Check for Knowledge Graph
      if (data.knowledge_graph || data.knowledgeGraph) {
        const kg = data.knowledge_graph || data.knowledgeGraph;
        displayKnowledgeGraph(kg);
      } else {
        kgEl.style.display = 'none';
      }

      if (!data.items || data.items.length === 0) {
        descEl.innerHTML = 'No matching results were found for your search query. Try using different keywords or check your spelling.';
        insightsEl.style.display = 'none';
        summary.classList.add('visible');
        return;
      }

      // === GENERATE DETAILED SUMMARY ===

      // 1. Extract and analyze domains/sources
      const domains = {};
      data.items.forEach(item => {
        try {
          const url = new URL(item.link);
          const domain = url.hostname.replace('www.', '');
          domains[domain] = (domains[domain] || 0) + 1;
        } catch (e) { }
      });
      const topDomains = Object.entries(domains)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 5);

      // 2. Extract key topics from titles and snippets
      const stopWords = new Set(['the', 'a', 'an', 'and', 'or', 'but', 'in', 'on', 'at', 'to', 'for', 'of', 'with', 'by', 'from', 'as', 'is', 'was', 'are', 'were', 'been', 'be', 'have', 'has', 'had', 'do', 'does', 'did', 'will', 'would', 'could', 'should', 'may', 'might', 'can', 'this', 'that', 'these', 'those', 'it', 'its', 'you', 'your', 'we', 'our', 'they', 'their', 'what', 'which', 'who', 'how', 'when', 'where', 'why', 'all', 'each', 'every', 'both', 'few', 'more', 'most', 'other', 'some', 'such', 'no', 'not', 'only', 'same', 'so', 'than', 'too', 'very', 'just', 'about', 'also', 'get', 'here', 'there', 'then', 'now']);
      const queryWords = new Set(searchQuery.toLowerCase().split(/\s+/));
      const wordFreq = {};

      data.items.forEach(item => {
        const text = `${item.title} ${item.snippet || ''}`;
        const words = text.toLowerCase().match(/\b[a-z]{4,}\b/g) || [];
        words.forEach(word => {
          if (!stopWords.has(word) && !queryWords.has(word)) {
            wordFreq[word] = (wordFreq[word] || 0) + 1;
          }
        });
      });
      const topTopics = Object.entries(wordFreq)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 6)
        .map(([word]) => word.charAt(0).toUpperCase() + word.slice(1));

      // 3. Analyze content types
      const hasImages = data.items.filter(item => item.pagemap?.cse_image).length;
      const hasVideos = data.items.filter(item =>
        item.link?.includes('youtube.com') ||
        item.link?.includes('vimeo.com') ||
        item.pagemap?.videoobject
      ).length;
      const hasArticles = data.items.filter(item =>
        item.pagemap?.article ||
        item.pagemap?.newsarticle
      ).length;

      // 4. Show loading state and fetch AI summary
      const summaryContentEl = document.getElementById('summaryContent');

      // Show loading shimmer
      summaryContentEl.innerHTML = `
        <div class="summary-loading line-1"></div>
        <div class="summary-loading line-2"></div>
        <div class="summary-loading line-3"></div>
      `;

      // Fetch AI summary from server
      fetchAISummary(searchQuery, data.items).then(aiSummary => {
        if (aiSummary) {
          summaryContentEl.innerHTML = `<p class="summary-description">${aiSummary}</p>`;
        } else {
          // Fallback to client-side summary
          const fallbackSummary = generateFallbackSummary(searchQuery, data.items, queryWords);
          summaryContentEl.innerHTML = `<p class="summary-description">${fallbackSummary}</p>`;
        }
      });

      // 5. Build insights section
      let insightsHTML = '';

      // Top Sources Card
      if (topDomains.length > 0) {
        insightsHTML += `
          <div class="insight-card">
            <div class="insight-title">
              <svg class="content-type-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/></svg>
              Top Sources
            </div>
            <div class="source-tags">
              ${topDomains.map(([domain, count]) =>
          `<a href="https://${domain}" target="_blank" rel="noopener noreferrer" class="source-tag">${domain}<span class="count">${count}</span></a>`
        ).join('')}
            </div>
          </div>
        `;
      }

      // Key Topics Card
      if (topTopics.length > 0) {
        insightsHTML += `
          <div class="insight-card">
            <div class="insight-title">
              <svg class="content-type-icon" viewBox="0 0 24 24"><path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/></svg>
              Related Topics
            </div>
            <div class="topic-pills">
              ${topTopics.map(topic => `<span class="topic-pill">${topic}</span>`).join('')}
            </div>
          </div>
        `;
      }

      // Content Types Card
      const contentTypes = [];
      if (hasImages > 0) contentTypes.push({ icon: 'üñºÔ∏è', label: `${hasImages} with images` });
      if (hasVideos > 0) contentTypes.push({ icon: 'üé¨', label: `${hasVideos} videos` });
      if (hasArticles > 0) contentTypes.push({ icon: 'üì∞', label: `${hasArticles} articles` });

      if (contentTypes.length > 0) {
        insightsHTML += `
          <div class="insight-card">
            <div class="insight-title">
              <svg class="content-type-icon" viewBox="0 0 24 24"><path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9h-4v4h-2v-4H9V9h4V5h2v4h4v2z"/></svg>
              Content Types
            </div>
            <div class="content-types">
              ${contentTypes.map(ct =>
          `<span class="content-type">${ct.icon} ${ct.label}</span>`
        ).join('')}
            </div>
          </div>
        `;
      }

      insightsEl.innerHTML = insightsHTML;
      insightsEl.style.display = insightsHTML ? 'grid' : 'none';

      // Show the summary
      summary.classList.add('visible');
    }

    function displayKnowledgeGraph(kg) {
      const kgEl = document.getElementById('knowledgeGraph');

      if (!kg || (!kg.title && !kg.description)) {
        kgEl.style.display = 'none';
        return;
      }

      let html = '';

      if (kg.image || kg.imageUrl) {
        html += `<img src="${kg.image || kg.imageUrl}" alt="${kg.title || ''}" class="kg-image">`;
      }

      html += '<div class="kg-info">';
      if (kg.title) {
        html += `<div class="kg-title">${kg.title}</div>`;
      }
      if (kg.type || kg.entity_type) {
        html += `<div class="kg-type">${kg.type || kg.entity_type}</div>`;
      }
      if (kg.description || kg.detailed_description) {
        const desc = kg.description || kg.detailed_description;
        const truncatedDesc = desc.length > 150 ? desc.substring(0, 150) + '...' : desc;
        html += `<div class="kg-description">${truncatedDesc}</div>`;
      }
      html += '</div>';

      kgEl.innerHTML = html;
      kgEl.style.display = 'flex';
    }

    function hideSearchSummary() {
      const summary = document.getElementById('searchSummary');
      summary.classList.remove('visible');
    }

    /* === AI Summary Functions === */
    async function fetchAISummary(searchQuery, items) {
      try {
        const response = await fetch('/summarize', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: searchQuery, results: items })
        });

        const data = await response.json();

        if (data.summary && !data.fallback) {
          return data.summary;
        }
        return null;
      } catch (error) {
        console.error('AI Summary fetch failed:', error);
        return null;
      }
    }

    function generateFallbackSummary(searchQuery, items, queryWords) {
      // Combine snippets intelligently
      const snippets = items.slice(0, 4)
        .map(item => item.snippet)
        .filter(Boolean);

      let summaryText = '';

      if (snippets.length > 0) {
        // Find the most informative sentences
        const allSentences = snippets.join(' ')
          .split(/[.!?]+/)
          .map(s => s.trim())
          .filter(s => s.length > 30 && s.length < 200);

        // Pick sentences that contain query terms
        const relevantSentences = allSentences
          .filter(s => {
            const lower = s.toLowerCase();
            return Array.from(queryWords).some(w => lower.includes(w));
          })
          .slice(0, 2);

        if (relevantSentences.length > 0) {
          summaryText = relevantSentences.join('. ') + '.';
        } else if (allSentences.length > 0) {
          summaryText = allSentences.slice(0, 2).join('. ') + '.';
        }
      }

      return `Based on ${items.length} results analyzed, here's what we found about <strong>${searchQuery}</strong>: ${summaryText}`;
    }

    /* === Display Results === */
    function displayResults(items, append = false) {
      const box = document.getElementById('resultsGrid');
      if (!append) box.innerHTML = '';

      // Filter out items without proper titles
      const validItems = (items || []).filter(item => {
        const title = item?.title?.trim();
        // Skip items with no title, empty title, or "Untitled"
        return title && title.toLowerCase() !== 'untitled' && title.length > 0;
      });

      if (!validItems || validItems.length === 0) {
        if (!append) box.innerHTML = '<div class="col-12 text-center mt-5 animate-fade-up"><h3 class="text-muted">No results found.</h3><p class="text-muted">Try a different keyword.</p></div>';
        return;
      }

      validItems.forEach((r, index) => {
        const img = r?.pagemap?.cse_image?.[0]?.src || '';
        const delay = (index % 10) * 0.1;

        const html = `
        <div class="col-md-6 col-lg-4 animate-fade-up" style="animation-delay: ${delay}s">
          <div class="card result-card h-100">
            <div class="card-body d-flex flex-column">
                <h5 class="card-title mb-3">
                  <a href="${r.link}" target="_blank" class="text-decoration-none text-break stretched-link">${r.title}</a>
                </h5>
                <div class="d-flex align-items-start gap-3">
                  ${img ? `<div class="rounded overflow-hidden flex-shrink-0" style="width:80px;height:80px;"><img src="${img}" class="w-100 h-100 object-fit-cover"></div>` : ''}
                  <p class="card-text text-muted small flex-grow-1 text-break mb-0" style="min-width: 0;">
                    ${r.snippet || ''}
                  </p>
                </div>
            </div>
          </div>
        </div>`;

        box.insertAdjacentHTML('beforeend', html);
      });
    }

    /* === Resizable Panels === */
    const container = document.getElementById('container');
    const left = document.getElementById('searchFrame');
    const right = document.getElementById('resultFrame');
    const divider = document.getElementById('divider');

    window.addEventListener('DOMContentLoaded', () => {
      left.style.flex = '0.3 1 0';
      right.style.flex = '0.7 1 0';
    });

    let drag = false;

    // Desktop Resize
    divider.addEventListener('mousedown', e => { drag = true; document.body.style.userSelect = 'none'; });
    document.addEventListener('mouseup', () => { drag = false; document.body.style.userSelect = ''; });
    document.addEventListener('mousemove', e => {
      if (!drag) return;
      const rect = container.getBoundingClientRect();
      let ratio = (e.clientX - rect.left) / rect.width;
      ratio = Math.max(0.15, Math.min(0.85, ratio));
      left.style.flex = `${ratio} 1 0`;
      right.style.flex = `${1 - ratio} 1 0`;
    });

    /* === Infinite Scroll === */
    function loadMore() {
      if (!query) return;
      page++;

      // Use local server endpoint
      fetch(`/search?q=${encodeURIComponent(query)}&start=${page * 10}`)
        .then(r => r.json())
        .then(d => {
          displayResults(d.items || [], true);
        })
        .catch(() => { });
    }

    const scrollTarget = window.innerWidth <= 768 ? window : document.getElementById('resultFrame');

    scrollTarget.addEventListener('scroll', function () {
      const isMobile = window.innerWidth <= 768;
      let scrollTop, clientHeight, scrollHeight;

      if (isMobile) {
        scrollTop = window.scrollY || document.documentElement.scrollTop || document.body.scrollTop;
        clientHeight = window.innerHeight;
        scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
      } else {
        scrollTop = this.scrollTop;
        clientHeight = this.clientHeight;
        scrollHeight = this.scrollHeight;
      }

      if (scrollTop + clientHeight >= scrollHeight - 100) {
        loadMore();
      }
    });

    /* === NEW: Watch for Search Box Visibility (Pop-up Button) === */
    const searchFrameObserver = new IntersectionObserver((entries) => {
      const btn = document.getElementById('floatingSearchBtn');
      // If searchFrame is NOT visible, show the button
      if (!entries[0].isIntersecting) {
        btn.classList.add('visible');
      } else {
        btn.classList.remove('visible');
      }
    }, {
      root: null,
      threshold: 0.1 // Trigger when < 10% of search box is visible
    });

    searchFrameObserver.observe(document.getElementById('searchFrame'));
  </script>

</body>

</html>